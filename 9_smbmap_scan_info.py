# Python script to use smbmap in kali linux. SMBMap scanns and enumerates network shares that use Server Message Block (SMB) protocol, commonly used in Windows environments. This tool helps to discover information about network shares and permission.

# Import the necessary library

import subprocess
from datetime import datetime

def run_smbmap(target_ip):
    # SMBMap linux command
    command = f"sudo smbmap -H {target_ip}"

    try:
        # Run the processes and capture the output
        result = subprocess.run(command, shell=True, capture_output=True, text=True, check=True)

        # Print the output
        print(result.stdout)

        return result.stdout

    except subprocess.CalledProcessError as e:
        # Handle errors if the smbmap command fails
        print(f"Error executing smbmap: {e}")
        print(f"Command output:\n{e.stdout}")
        print(f"Command error:\n{e.stderr}")

        return None

def write_file(output_file, result):
    with open(output_file, "a") as result_file:
        result_file.write("\nSmbap scan result:\n")
        result_file.write(result)

if __name__ == "__main__":
    # Target IP
    target_ip = "192.168.0.2"

    # File
    output_file = "vulnerability_report.txt"

    # Time
    time = datetime.now()

    # Run the smbap function
    result = run_smbmap(target_ip)
    write_file(output_file, result)

    # Print information
    print(f"SMBMap scan result saved to {output_file} at {time}")
