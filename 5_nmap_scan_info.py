# We will use a  python script that uses  Nmap to check for open ports and running services

# Import the necessary library

import subprocess
from datetime import datetime

def nmap_scan(target_ip, target_ports):
    #Nmap Linux command
    command = f"nmap -p {target_ports} {target_ip}"

    try:
        # Run the command and the output
        result = subprocess.run(command, shell=True, capture_output=True, text=True, check=True)

        # Print the output
        print(result.stdout)

        return result.stdout

    except subprocess.CalledProcessError as e:
        # Handle errors if nmap command fails
        print(f"Error executing nmap: {e}")
        print(f"Command output:\n{e.stdout}")
        print(f"Command error:\n{e.stderr}")

        return None

def write_result(output_file, result):
    with open(output_file, "a") as result_file:
        result_file.write("\nResults from Nmap Scan:\n")
        result_file.write(result)

if __name__ == "__main__":
    # IP range
    target_ip = "192.168.0.2"
    # Ports range
    target_ports = "1-9999"
    
    # File
    output_file = "vulnerability_report.txt"

    # Time
    time = datetime.now()


    # Call the nmap_scan function
    nmap_result = nmap_scan(target_ip, target_ports)

    if nmap_result is not None:
        write_result(output_file, nmap_result)

    # Print information
    print(f"Nmap scan result saved to {output_file} at {time}")
